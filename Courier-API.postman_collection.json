{
  "info": {
    "name": "Courier Delivery Backend API",
    "description": "Complete API collection for Courier Delivery Backend with NestJS + TypeORM + PostgreSQL",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "refreshToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminId",
      "value": "",
      "type": "string"
    },
    {
      "key": "merchantId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Admin Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.environment.set('accessToken', response.accessToken);",
                  "    pm.environment.set('refreshToken', response.refreshToken);",
                  "    pm.environment.set('adminId', response.user.id);",
                  "    pm.collectionVariables.set('accessToken', response.accessToken);",
                  "    pm.collectionVariables.set('refreshToken', response.refreshToken);",
                  "    pm.collectionVariables.set('adminId', response.user.id);",
                  "    console.log('Tokens saved to variables');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"identifier\": \"admin@courier.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "Merchant Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.environment.set('accessToken', response.accessToken);",
                  "    pm.environment.set('refreshToken', response.refreshToken);",
                  "    pm.collectionVariables.set('accessToken', response.accessToken);",
                  "    pm.collectionVariables.set('refreshToken', response.refreshToken);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"identifier\": \"+8801711111111\",\n  \"password\": \"TestPass123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.environment.set('accessToken', response.accessToken);",
                  "    pm.environment.set('refreshToken', response.refreshToken);",
                  "    pm.collectionVariables.set('accessToken', response.accessToken);",
                  "    pm.collectionVariables.set('refreshToken', response.refreshToken);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            }
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout"]
            }
          }
        }
      ]
    },
    {
      "name": "Email Testing",
      "item": [
        {
          "name": "Verify Email Connection",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/email/verify",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "email", "verify"]
            },
            "description": "Verify SMTP connection to Zoho Mail. Returns success if email service is configured and connected."
          }
        },
        {
          "name": "Send Test Email",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"your-email@gmail.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/email/test",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "email", "test"]
            },
            "description": "Send a test email to verify email functionality. Replace 'your-email@gmail.com' with your actual email address."
          }
        }
      ]
    },
    {
      "name": "Merchants",
      "item": [
        {
          "name": "Merchant Signup",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.merchant) {",
                  "        pm.collectionVariables.set('merchantId', response.data.merchant.id);",
                  "        console.log('Merchant ID saved:', response.data.merchant.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"full_name\": \"ABC Electronics Store\",\n  \"phone\": \"+8801711222333\",\n  \"email\": \"merchant.test@gmail.com\",\n  \"password\": \"Merchant123!\",\n  \"thana\": \"Gulshan\",\n  \"district\": \"Dhaka\",\n  \"full_address\": \"House 15, Road 5, Gulshan-2, Dhaka\",\n  \"secondary_number\": \"+8801811222333\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/merchants/signup",
              "host": ["{{baseUrl}}"],
              "path": ["merchants", "signup"]
            }
          }
        },
        {
          "name": "Get All Merchants",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/merchants",
              "host": ["{{baseUrl}}"],
              "path": ["merchants"]
            }
          }
        },
        {
          "name": "Get Pending Merchants",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/merchants?status=PENDING",
              "host": ["{{baseUrl}}"],
              "path": ["merchants"],
              "query": [
                {
                  "key": "status",
                  "value": "PENDING"
                }
              ]
            }
          }
        },
        {
          "name": "Get Approved Merchants",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/merchants?status=APPROVED",
              "host": ["{{baseUrl}}"],
              "path": ["merchants"],
              "query": [
                {
                  "key": "status",
                  "value": "APPROVED"
                }
              ]
            }
          }
        },
        {
          "name": "Get Merchants by District",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/merchants?district=Dhaka",
              "host": ["{{baseUrl}}"],
              "path": ["merchants"],
              "query": [
                {
                  "key": "district",
                  "value": "Dhaka"
                }
              ]
            }
          }
        },
        {
          "name": "Get Merchant by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/merchants/{{merchantId}}",
              "host": ["{{baseUrl}}"],
              "path": ["merchants", "{{merchantId}}"]
            }
          }
        },
        {
          "name": "Update Merchant",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullAddress\": \"Updated Address: House 20, Road 10, Dhanmondi\",\n  \"secondaryNumber\": \"+8801999999999\",\n  \"thana\": \"Mohammadpur\",\n  \"district\": \"Dhaka\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/merchants/{{merchantId}}",
              "host": ["{{baseUrl}}"],
              "path": ["merchants", "{{merchantId}}"]
            }
          }
        },
        {
          "name": "Approve Merchant (Triggers Email!)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            },
            "url": {
              "raw": "{{baseUrl}}/merchants/{{merchantId}}/approve",
              "host": ["{{baseUrl}}"],
              "path": ["merchants", "{{merchantId}}", "approve"]
            },
            "description": "Approve a merchant account (Admin only). This will:\n1. Change merchant status to APPROVED\n2. Record approval timestamp and admin ID\n3. Send approval email to merchant's registered email address\n\nMake sure the merchant has an email address in their profile!"
          }
        }
      ]
    },
    {
      "name": "Hubs (Future)",
      "item": [
        {
          "name": "Create Hub",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"hubCode\": \"DH-001\",\n  \"branchName\": \"Dhaka Central Hub\",\n  \"area\": \"Dhanmondi\",\n  \"address\": \"Plot 25, Road 12, Dhanmondi, Dhaka-1209\",\n  \"managerName\": \"John Manager\",\n  \"managerPhone\": \"+8801733333333\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/hubs",
              "host": ["{{baseUrl}}"],
              "path": ["hubs"]
            }
          }
        },
        {
          "name": "Get All Hubs",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/hubs",
              "host": ["{{baseUrl}}"],
              "path": ["hubs"]
            }
          }
        }
      ]
    },
    {
      "name": "Riders (Future)",
      "item": [
        {
          "name": "Create Rider",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Mike Rider\",\n  \"phone\": \"+8801755555555\",\n  \"password\": \"RiderPass123\",\n  \"hubId\": \"hub-uuid-here\",\n  \"licenseNo\": \"DL-123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/riders",
              "host": ["{{baseUrl}}"],
              "path": ["riders"]
            }
          }
        },
        {
          "name": "Get All Riders",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/riders",
              "host": ["{{baseUrl}}"],
              "path": ["riders"]
            }
          }
        },
        {
          "name": "Get Riders by Hub",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/riders?hubId=hub-uuid-here",
              "host": ["{{baseUrl}}"],
              "path": ["riders"],
              "query": [
                {
                  "key": "hubId",
                  "value": "hub-uuid-here"
                }
              ]
            }
          }
        }
      ]
    }
  ]
}
